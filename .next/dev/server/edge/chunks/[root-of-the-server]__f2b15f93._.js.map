{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\n\r\n// Define protected routes that require authentication\r\nconst protectedRoutes = [\r\n  '/profile',\r\n  '/settings',\r\n  '/api/profile',\r\n];\r\n\r\n// Define public routes that don't require authentication\r\nconst publicRoutes = [\r\n  '/',\r\n  '/login',\r\n  '/signup',\r\n  '/forgot-password',\r\n  '/reset-password',\r\n  '/api/auth/login',\r\n  '/api/auth/signup',\r\n  '/api/auth/logout',\r\n  '/api/auth/forgot-password',\r\n  '/api/auth/reset-password',\r\n  '/api/auth/callback',\r\n  '/terms',\r\n  '/privacy',\r\n];\r\n\r\nfunction isProtectedRoute(pathname: string): boolean {\r\n  return protectedRoutes.some(route => pathname.startsWith(route));\r\n}\r\n\r\nfunction isPublicRoute(pathname: string): boolean {\r\n  // Check exact matches and also allow Next.js static files\r\n  if (publicRoutes.includes(pathname)) {\r\n    return true;\r\n  }\r\n\r\n  // Allow Next.js internals and static assets\r\n  if (\r\n    pathname.startsWith('/_next') ||\r\n    pathname.startsWith('/favicon') ||\r\n    pathname.match(/\\.(ico|png|jpg|jpeg|svg|gif|woff|woff2|ttf|eot|css|js)$/)\r\n  ) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nexport function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n  const sessionCookie = request.cookies.get('bfeai_session');\r\n\r\n  // If user is logged in and visits login/signup/root, redirect to profile\r\n  // This provides a better UX for already-authenticated users\r\n  if (sessionCookie?.value && (pathname === '/' || pathname === '/login' || pathname === '/signup')) {\r\n    return NextResponse.redirect(new URL('/profile', request.url));\r\n  }\r\n\r\n  // Allow public routes\r\n  if (isPublicRoute(pathname)) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Check if route requires protection\r\n  if (!isProtectedRoute(pathname)) {\r\n    // Route is neither protected nor explicitly public - allow by default\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // Protected route - check for session cookie (already fetched above)\r\n  if (!sessionCookie?.value) {\r\n    // No session cookie - redirect to login\r\n    const loginUrl = new URL('/login', request.url);\r\n    loginUrl.searchParams.set('redirect', pathname);\r\n    return NextResponse.redirect(loginUrl);\r\n  }\r\n\r\n  // Cookie exists - allow access\r\n  // Full JWT verification will be done in pages/API routes as needed\r\n  // This keeps middleware Edge Runtime compatible\r\n  return NextResponse.next();\r\n}\r\n\r\n// Configure which routes the middleware should run on\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match all request paths except:\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     */\r\n    '/((?!_next/static|_next/image|favicon.ico).*)',\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGA,sDAAsD;AACtD,MAAM,kBAAkB;IACtB;IACA;IACA;CACD;AAED,yDAAyD;AACzD,MAAM,eAAe;IACnB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,SAAS,iBAAiB,QAAgB;IACxC,OAAO,gBAAgB,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC;AAC3D;AAEA,SAAS,cAAc,QAAgB;IACrC,0DAA0D;IAC1D,IAAI,aAAa,QAAQ,CAAC,WAAW;QACnC,OAAO;IACT;IAEA,4CAA4C;IAC5C,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,eACpB,SAAS,KAAK,CAAC,4DACf;QACA,OAAO;IACT;IAEA,OAAO;AACT;AAEO,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC;IAE1C,yEAAyE;IACzE,4DAA4D;IAC5D,IAAI,eAAe,SAAS,CAAC,aAAa,OAAO,aAAa,YAAY,aAAa,SAAS,GAAG;QACjG,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,YAAY,QAAQ,GAAG;IAC9D;IAEA,sBAAsB;IACtB,IAAI,cAAc,WAAW;QAC3B,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,qCAAqC;IACrC,IAAI,CAAC,iBAAiB,WAAW;QAC/B,sEAAsE;QACtE,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,qEAAqE;IACrE,IAAI,CAAC,eAAe,OAAO;QACzB,wCAAwC;QACxC,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY;QACtC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,+BAA+B;IAC/B,mEAAmE;IACnE,gDAAgD;IAChD,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAGO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;KAKC,GACD;KACD;AACH"}}]
}